
    这部分基于树莓派以及一些开源软件构建  
    树莓派从摄像头模块获取输入，然后通过无线方式发送获得的图像数据到电脑，电脑通过之前训练好的神经网络对输入的图像数据预测小车接下来的动作，然后发送这些预测动作的控制指令到树莓派控制小车的程序中。小车根据这些获得的指令实现自动驾驶

## 第1节 环境准备：更加更加专业的视觉系统，甚至有一点人工智能

    需要安装一些Python库并正确连接小车

### **硬件准备**

#### 硬件清单

- 树莓派
- 树莓派电机扩展板
- 摄像头
- 小车套件

#### 硬件连接

<center><img src=https://md.hass.live/niji/2019-05-07-Xnip2019-05-07_15-41-17.png?imageView2/0/interlace/1/q/46|imageslim></center>

### **程序及操作**

#### 操作步骤

1.通过HDMI显示器连接树莓派，并使用USB键盘鼠标进行控制  
2.在桌面上面找到名字为`learn-ai`的文件夹,打开路径`chapter2/part3/self_driving_car/`  
3.在桌面按`ctrl`+`alt`+`T`来打开终端  
4.打开终端后，执行以下命令  

```bash
sudo apt update
install python3 ???
sudo apt install sklearn ???
```

### 电机和摄像头驱动测试

#### 操作步骤-电机测试

1.打开桌面上的`learn-ai`文件夹，打开路径`chapter2/part3/self_driving_car/`  
2.打开终端，执行以下命令  

```bash {.line-numbers}
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd computer
sudo python3 drive_api2.py -s 150  //-s 150作为可选的参数，来指定行驶速度。可选范围是0-256
```

3.打开树莓派上的网络浏览器，在地址栏输入路由器管理地址，查看树莓派IP地址  
4.在浏览器地址栏输入树莓派IP:81/drive,例如（192.168.0.100:81/drive）  
5.在打开的界面上按键盘上的上下左右方向键来测试小车  
6.测试完毕后，在终端输入`Ctrl`+`C`来结束当前任务

#### 操作步骤-摄像头测试

1.打开桌面上的`learn-ai`文件夹，打开路径`chapter2/part3/self_driving_car/`  
2.打开终端，执行以下命令  

```bash {.line-numbers}
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd test
sudo python3 stream_server_test.py
```

3.新建一个终端窗口  

<center><img src="https://md.hass.live/terminal.png"></center>

4.在新的终端窗口中输入以下命令，如果有正常的视频画面输出，则测试通过  

```bash {.line-numbers}
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd raspberryPi
sudo python3 stream_client.py
```

5.在终端输入`Ctrl`+`C`来结束当前任务  

## 第2节 无人驾驶数据采集及训练

    搭建起车道，然后运行相应的收集数据的程序，按下笔记本的方向控制小车行驶，每按一次方向键，程序就会记录下一帧相应的图像。让小车平均遍历自动驾驶中可能出现的各种情况，按‘q‘退出数据采集，然后再运行相应的模型训练程序训练自动驾驶神经网络

### **硬件准备**

#### 硬件清单

- 纸
- 胶带

#### 硬件搭建-跑道

- 地面颜色为纯色，与所用纸张的颜色对比度应较大
- 跑道的宽度稍大于车的宽度  
- 可以把拐弯处的弯度设计得稍大一些

<center><img src=https://md.hass.live/track.jpg></center>

### **程序及操作**

#### 操作步骤-驾驶数据采集

1.打开`learn-ai`文件夹，打开路径`chapter2/part3/`  
2.打开终端，执行以下命令  

```bash
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd computer
sudo python3 collect_training_data2.py
```

3.新建一个终端窗口，输入  

```bash {.line-numbers}
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd raspberryPi
sudo python3 stream_client.py
```

4.描述训练过程，按`q`结束训练  

#### 操作步骤-驾驶数据训练

1.新建一个终端窗口，输入  

```bash {.line-numbers}
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd computer
sudo python3 model_training.py
```

2.训练完成后，训练文件在`文件路径`

## 第3节 开始无人驾驶

    根据训练好的神经网络模型，现在我们可以实现自动驾驶

### **程序及操作**

#### 操作步骤

1.打开终端，输入  

```bash {.line-numbers}
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd computer
python3 rc_drive_nn_only.py
```

2.新建一个终端窗口，输入  

```bash {.line-numbers}
cd ~/Desktop/learn-ai/chapter2/part3/self_driving_car
cd raspberryPi
python stream_client.py
```
