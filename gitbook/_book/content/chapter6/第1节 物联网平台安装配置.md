# 第1节 物联网平台安装配置

---

>Home Assistant是一个开源的物联网平台，兼容各种物联网协议。可以方便的接入和控制各种设备
>树莓派的操作系统在SD卡上，分发给同学的SD卡默认安装了所有的环境和依赖，相关的文档在桌面上  

### 初始操作（已完成,无需操作或教师操作）

#### 1.Win32DiskImager恢复镜像

![微信截图_20190827191950](https://md.hass.live/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190827191950.png)

选择待恢复映像和待写入磁盘盘符，然后点按`写入`

#### 2.WiFi配置

在boot分区创建文件`wpa_supplicant.conf`

```bash
country=CN
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
ssid="WiFi名字-不要删掉引号"
psk="WiFi密码-不要删掉引号"
key_mgmt=WPA-PSK
priority=1
}
```

### 环境安装（已完成，无需操作或教师操作）

#### 1.树莓派通电，使用ssh连接

账号`pi`，密码`raspberry`

#### 2.安装Docker

`curl -ssl https://get.docker.com | sh`

#### 3.通过Docker安装HomeAssistant

```bash
#sudo docker run --init -d --name="home-assistant" -v /home/pi/homeassistant:/config -v /etc/
localtime:/etc/localtime:ro --net=host homeassistant/raspberrypi3-homeassistant:0.82.0
# 安装依赖
sudo apt-get install apparmor-utils apt-transport-https avahi-daemon ca-certificates curl dbus jq network-manager socat software-properties-common
curl -sL "https://raw.githubusercontent.com/home-assistant/hassio-installer/master/hassio_install.sh" >> hassio_install.sh
sudo bash hassio_install.sh -m raspberrypi4
//启动服务，大概需要1分钟
//退出配置环境，输入
exit
```

- 主要配置在`configuration.yaml`中  
- 文件夹`custom_components`存放自定义组件
- 使用`cat configuration.yaml`查看
- 使用`nano configuration.yaml`编辑

#### 4.安装麦克风扩展板驱动

```bash
cd ~
git clone https://github.com/waveshare/WM8960-Audio-HAT
cd WM8960-Audio-HAT
sudo ./install.sh
sudo reboot
```

#### 5.通过Docker安装Snowboy

```bash
//<https://github.com/Kitt-AI/snowboy>
sudo docker pull wupanhao/snowboy:1.0
//启动镜像
sudo docker run -idt --name="rapiro" --privileged -v /home/pi/rapiro:/rapiro wupanhao/snowboy:1.0 /bin/bash
//进入镜像
sudo docker exec -it rapiro env LANG=C.UTF-8 /bin/bash
```
