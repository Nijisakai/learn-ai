# 环境准备

![os](https://img.shields.io/badge/platform-windows%20%7C%20macos%20%7C%20linux-lightgrey)

---
> 相关软件，代码及课程资源，**请[点击这里](../codes/下载.md)来下载**  
>也可以选择在下方提供的官方网址下载  
>推荐按顺序依次安装以下软件，以避免因依赖问题报错  
> **Arduino建议使用我们提供的预先配置好的版本**

## 在你的电脑上的操作

### Anaconda

Anaconda是一个Python环境管理软件。在Windows、Mac、Linux上均可以方便安装。下载链接：<https://www.anaconda.com/products/individual>
![anacondanew](https://md.hass.live/anacondanew.png)

#### setup

1. 下载安装Anaconda  
2. Linux和macOS用户打开`终端`, Windows用户在开始菜单打开`Anaconda Prompt`  
3. 创建并进入环境  

```bash
#创建一个名字为learn-ai的虚拟环境
conda create -n learn-ai

#激活learn-ai虚拟环境
conda activate learn-ai
```

4. 在新环境中安装TensorFlow和OpenCV（若电脑有独立显卡应安装GPU版本的TensorFlow）

```bash
#安装Tensorflow
##无独立显卡的电脑使用这条命令
conda install tensorflow
##有独立显卡的电脑使用这条命令
conda install tensorflow-gpu

#安装opencv
conda install opencv

#安装git命令
conda install git
```

#### Anaconda基本命令概览（仅说明，勿执行）

##### 创建环境

```bash
conda create -n 环境名字
#例如：
conda create -n py27 python=2.7
##表示创建一个名字为py27，运行python2.7的虚拟环境
##后面的python=2.7是可选输入
##不输入时默认环境是python3
```

##### 进入环境

```bash
conda activate 环境名字
#例如：  
conda activate py27
```

##### 安装指定包  

```bash
conda install 包名  
#例如：安装OpenCV
conda install opencv
```

##### 其他命令

```bash
#退出环境
conda deactivate  
#列出环境
conda-env list
#删除环境
conda-env remove -n 环境名字
```

### CP2102驱动

> Linux用户不用安装

这个驱动用于使用USB串口连接esp8266。注意选择对应的操作系统和版本进行下载和安装。下载链接: <https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers>

### Arduino IDE

**选择预先配置好的[集成版本](link)**

Arduino IDE（Integrated Development Environment,集成开发环境）是针对Arduino控制板的编程和下载平台。在Windows，Mac、Linux上均可以方便安装。Arduino项目文件的后缀是`*.ino` 。项目文件应在与项目名相同的文件夹中。
下载链接：<https://www.arduino.cc/en/Main/Software?setlang=cn>

#### setup

1. 下载安装Arduino IDE  
2. 在`文件`--`首选项`--`附加开发板管理器网址`一栏中输入<https://arduino.esp8266.com/stable/package_esp8266com_index.json,https://dl.espressif.com/dl/package_esp32_index.json> 重启IDE

![arduino-config-1](https://md.hass.live/niji/2019-05-09-Xnip2019-05-09_18-19-37.png)

3. 在`工具`--`开发板`--`开发板管理器`中分别搜索esp8266和esp32，选择最新版本进行安装  

![esp8266](https://md.hass.live/2019-04-29%2022.10.50.gif?imageView2/0/interlace/1/q/46|imageslim)

![esp32](https://md.hass.live/niji/2019-05-09-2019-05-09%2018.22.25.gif?imageView2/0/interlace/1/q/46|imageslim)

4. 在`工具`--`管理库`中搜索DHT，选择DHT sensor library by Adafruit

![dht](https://md.hass.live/niji/2019-05-22-Xnip2019-05-22_13-50-38.png)

5. 在`工具`--`管理库`中搜索选择选择Adafruit Unifled Sensor by Adafruit

![ada2](https://md.hass.live/niji/2019-05-22-Xnip2019-05-22_13-57-25.png)

6. 打开链接<https://github.com/esp8266/arduino-esp8266fs-plugin/releases>,选择.zip文件下载，将解压后的文件夹复制到`Arduino安装目录/tools`文件夹，然后重启IDE

![arduino-config-2](https://md.hass.live/arduinoconfig2.png?imageView2/0/interlace/1/q/46|imageslim)

默认的路径应该是这样：`/Arduino/tools/ESP8266FS/tool/esp8266fs.jar`
如果安装成功，会在`工具`菜单下看到下图选项:

<center><img src=https://md.hass.live/niji/2019-05-07-Xnip2019-05-07_23-41-38.png></center>

7. 设置开发板和端口

<center><img src=https://md.hass.live/Xnip2019-05-05_16-49-07.png?imageView2/0/interlace/1/q/46|imageslim></center>

### VSCode（可选）

VSCode是微软出品的免费代码编辑软件。在Windows、Mac、Linux上均可以方便安装。下载链接：<https://code.visualstudio.com>

#### setup

1. 下载安装VSCode  
2. 安装插件`Settings Sync`（同步功能目前已集成在软件中）

![2019-04-29 21.49.44](https://md.hass.live/2019-04-29%2021.49.44.gif)

3.输入`Shift`+`Alt`+`D`,输入GitHub Token和Gist Token([点击获取](http://hass.live:8999/))，即可从服务端同步设置。免去自己配置的麻烦

---

## 教学路由器配置

教学的路由器设置SSID名字为**AI**，密码为**raspberry**  
路由器管理地址设置为<http://192.168.123.1>，登录账号：admin，登录密码：admin

---

## 在树莓派上的操作

>我们已经为树莓派配置好了全部环境和学习用的文件，并制作了恢复镜像提供下载。也可以直接使用我们烧录好的SD卡。

### 镜像恢复

在[这里](../codes/下载.md)下载最新的恢复镜像和备份恢复软件。
将32G或以上的TF卡插入到读卡器，连接到电脑。
使用[Etcher](https://www.balena.io/etcher/)或[Win32DiskImager](https://sourceforge.net/projects/win32diskimager/)进行镜像恢复。

#### Etcher

![steps-8006dca57323756b1b84fb9408742409](https://md.hass.live/steps-8006dca57323756b1b84fb9408742409.gif)

选择镜像文件，和读卡器的盘符，点击**Flash**

#### Win32DiskImager

![微信截图_20190827191950](https://md.hass.live/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190827191950.png)

选择待恢复镜像和待写入磁盘盘符，然后点按`写入`

### 连接到路由器并获取局域网地址

树莓派默认连接的WiFi名称是**AI**，密码是**raspberry**。如果你的路由器名称和密码不是这个的话，你可以：

#### 插网线

从路由器的LAN口引出网线，连接到树莓派。打开你的路由器管理页面，查看树莓派分配到的IP地址。

#### 如果没有网线

修改树莓派的配置文件，使其连接到你现有的WiFi。  
恢复完成后，在电脑上会出现一个**boot**分区。
在boot分区创建文件`wpa_supplicant.conf`，写入以下内容。

```bash
country=CN
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
ssid="WiFi名字-不要删掉引号"
psk="WiFi密码-不要删掉引号"
key_mgmt=WPA-PSK
priority=1
}
```

### 连接到路由器并获取局域网地址

#### 外接显示器

这是最简单的方式，通过HDMI接口外接显示器即可。

#### 远程桌面

在Windows和macOS上通过应用商店下载`Microsoft远程桌面`程序
在Linux上下载安装`VNC Viewer`

#### SSH

恢复完成后，在电脑上会出现一个**boot**分区。在boot分区创建文件`ssh`

---

### 树莓派环境说明

#### Docker（虚拟容器）

```bash
sudo curl -sL get.docker.com | sed 's/9)/10)/' | sh
```

#### Nginx（网络服务器）

```bash
sudo apt install nginx
systemctl enable nginx
systemctl start nginx
systemctl status nginx
```

#### HomeAssistant（物联网平台）

>Home Assistant是一个开源的物联网平台，兼容各种物联网协议。可以方便的接入和控制各种设备

```bash
# Install hassio dependencies
sudo apt-get install apparmor-utils apt-transport-https avahi-daemon ca-certificates curl dbus jq network-manager socat software-properties-common

# Install hassio
cd ~
curl -sL "https://raw.githubusercontent.com/home-assistant/hassio-installer/master/hassio_install.sh" >> hassio_install.sh

sudo nano hassio_install.sh
---
"armv7l")
        HOMEASSISTANT_DOCKER="$DOCKER_REPO/raspberrypi3-homeassistant"
        HASSIO_DOCKER="$DOCKER_REPO/armhf-hassio-supervisor"
    ;;
---

sudo bash hassio_install.sh
```

#### Snowboy（语音助手）

```bash
# https://github.com/Kitt-AI/snowboy
sudo docker pull wupanhao/snowboy:1.0
# 启动镜像
sudo docker run -idt --name="rapiro" --privileged -v /home/pi/rapiro:/rapiro wupanhao/snowboy:1.0 /bin/bash
# 进入镜像
sudo docker exec -it rapiro env LANG=C.UTF-8 /bin/bash
```

#### 麦克风扩展板驱动

```bash
git clone https://github.com/waveshare/WM8960-Audio-HAT
cd WM8960-Audio-HAT
sudo ./install.sh
sudo reboot
```

#### Python相关环境

```bash
python2 -m pip list
#output
python3 -m pip list
#output
```

#### 课程项目文件

已经将课程相关文件放置在桌面`learn-ai`文件夹中。

#### 其他

已经配置安装好各类常用软件，如Arduino，VSCode等。
