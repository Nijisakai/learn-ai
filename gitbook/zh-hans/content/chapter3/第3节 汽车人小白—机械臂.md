# 第3节 汽车人小白—机械臂

---

>使用ESP8266，通过网页端发送命令，控制多个舵机

### 活动目标

- 了解舵机的基本概念
- 了解使用开发板控制动力设备的基本原理
- 熟悉使用Arduino IDE烧录固件的操作流程

### 背景知识：舵机

伺服电机通常被称为舵机，它是一种带有输出轴的小装置。当我们向伺服器发送一个控制信号时，输出轴就可以转到特定的位置。只要控制信号持续不变，伺服机构就会保持轴的角度位置不改变。如果控制信号发生变化，输出轴的位置也会相应发生变化。日常生活中，舵机常被用于遥控飞机、遥控汽车、机器人等。

![舵机结构](https://md.hass.live/niji/2019-05-27-%E8%88%B5%E6%9C%BA%E6%8B%86%E8%A7%A3.jpg)

舵机内部的控制电路、电位计（可变电阻器）和电机均被连接到电路板上。控制电路通过电位计可监控舵机的当前角度。  

其工作流程为：控制信号 → 控制电路板 → 电机转动 → 齿轮组减速 → 舵盘转动 → 位置反馈电位计 → 控制电路板反馈。

![舵机转动图](https://md.hass.live/niji/2019-05-27-SERVO.gif)

#### 1.脉冲宽度调制（PWM）

脉冲宽度调制，英文名Pulse Width Modulation，缩写为PWM，它是通过对一系列脉冲的宽度进行调制，等效出所需要的波形，对模拟信号电平进行数字编码。

#### 2.占空比

占空比是指在一个周期内，信号处于高电平的时间占据整个信号周期的百分比。

![占空比](https://md.hass.live/niji/2019-05-27-Xnip2019-05-27_09-37-35.png)

上图信号一个周期的时间为4ms，其中高电平时间为1ms。占空比为：$$ \frac {高电平时间} {一个周期} = \frac {1ms} {4ms} = 25\% $$

### 原理图

``` sequence
舵机机械臂->小白: GPIO
小白->手机浏览器: 1.建立局域网服务器
手机浏览器-->小白: 2.通过WiFi访问控制界面
手机浏览器-->小白: 3.提交执行舵机角度请求
小白->手机浏览器: 4.服务器响应请求，让小白的动力系统执行
```

### 硬件清单

- ESP8266主板
- 电机扩展板 esp12E Motor Shield
- 舵机
- 杜邦线、数据线
- 机械臂和零件

### 实验：机械臂

#### 1.硬件连接

![微信截图_20191204152900](https://md.hass.live/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20191204152900.png)
<center>此处表示舵机连接到了D0口，最多可以连9个舵机（D0-D9）<br>
<font color=orange>黄色</font>-信号D（DATA）<br>
<font color=red>红色</font>-正极V（VCC）<br>
<font color=brown>棕色</font>-负极G（GND）<br>
</center>

#### 2.烧录程序到开发板

1).打开项目文件夹`learn-ai/codes/chapter3/part3_ServoArm/ESP8266_servoarm_http`
2).将ESP8266通过数据线连接到电脑
3).使用Arduino IDE打开文件`ESP8266_servoarm_http.ino`
4).记得把前面的[环境准备](#setup-2)部分再次确认，将环境正确配置，然后点击上传按钮进行上传
![上传](https://md.hass.live/niji/2019-05-08-Xnip2019-05-08_10-15-02.png?imageView2/0/interlace/1/q/46|imageslim)
5).点击`工具`菜单，选择`ESP8266 Sketch Data Upload`,会自动将项目目录下的data文件夹上传到ESP8266开发板上

#### 3.开始机械臂控制

1).打开[路由器管理地址](http://192.168.123.1)，ESP8266此时应该已经加入到了局域网中，查看ESP8266获取到的路由器地址  
2).将ESP8266与电脑连接断开，连接到移动电源上
3).在浏览器中打开ESP8266获取到的局域网地址，通过拖动滑块来控制机械臂
4).通过[内网转发](https://github.com/fatedier/frp/blob/master/README_zh.md)技术，**同学们在家里可以[打开这里](http://hass.live:9035)来查看老师手边传感器的实时读数。**

![微信截图_20190830114834](https://md.hass.live/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190830114834.png)
