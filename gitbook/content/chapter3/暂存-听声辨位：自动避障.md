# 第3节 听声辨位：自动避障

>使用esp8266，加上超声传感器，设计一辆自动避障小车

### **学习流程**

#### 课程引入（10分钟）

活动名称 | 活动内容 | 时间分配
:-: | :-: | :-:
活动目标| 设计一辆能够自动躲避障碍物的小车 | 5分钟
背景知识 | 超声测距的原理 | 5分钟

#### 基本任务（30分钟）

活动名称 | 活动内容 | 时间分配
:-: | :-: | :-:
硬件准备 | 将硬件按文档进行连接 | 5分钟
程序及操作 | 完成程序及操作文档部分 | 25分钟

#### 活动小结（5分钟）

---

### **活动目标**

- 学会控制esp8266的GPIO
- 学会使用电机驱动扩展模块（ESP12E）
- 学会使用esp8266的服务器

### **背景知识**

#### **超声传感器**

超声波传感器是一个输入模块，提供了非常好的非接触范围检测，性能稳定，易于使用，盲区小，准确度高，测距距离从2厘米到400厘米不等，关键是还很便宜，在创客圈应用最为广泛，包括：机器人测距避障，液位检测等。  
一般来说，超声传感器有四个引脚:  
1.GND引脚，接地  
2.VCC引脚，接电源  
3.TRIG引脚，控制端，接开发板的输出端口  
4.ECHO引脚，接收端，接开发板的输入端口  

#### **超声波测距原理**

 超声波传感器的发射器向某一方向发射超声波，在发射的同时开始计时，超声波在空气中传播，途中碰到障碍物就立即返回来，  
 超声波接收器收到反射波就立即停止计时。根据计时器记录的时间t，声波在空气中的传播速度为340m/s，就可以计算出发射点  
 距障碍物的距离s，即：s=340m/s× t / 2 。这就是所谓的时间差测距法。  

### 原理图

```sequence
超声波传感器->小白: GPIO
Note right of 小白: 1.建立局域网服务器\n2.处理超声波数据\n3.将超声波数据处理结果传递给电机，执行避障
```

### **硬件准备**

#### 硬件清单

- esp8266主板
- 电机扩展板 esp12E Motor Shield  
- 两个超声传感器  
- 两个舵机  
- 一个蜂鸣器
- 小车套件(3D打印的底盘和夹层，电机，车轮，铜柱等)
- 杜邦线，数据线  
- 电源（电池或者充电宝）

#### 硬件连接

<center><img src=https://md.hass.live/niji/2019-06-18-Xnip2019-06-18_16-40-35.png></center>

### **程序及操作**

#### 操作步骤

1.打开`learn-ai`文件夹，打开路径`codes/chapter2/esp8266_projects/esp8266_Auto_avoid_car`  
2.将esp8266通过数据线连接到电脑  
3.使用Arduino IDE打开文件`esp8266_WiFicar_https.ino`  
4.记得把前面的[环境准备](#setup-2)部分再次确认，将环境正确配置，然后点击上传按钮进行上传  

<center><img src='https://md.hass.live/niji/2019-05-08-Xnip2019-05-08_10-15-02.png?imageView2/0/interlace/1/q/46|imageslim'></center>

5.点击`工具`菜单，选择`esp8266 Sketch Data Upload`,会自动将项目目录下的data文件夹上传到esp8266开发板上  
6.打开[路由器管理地址](http://192.168.0.1)，esp8266此时应该已经加入到了局域网中，查看esp8266获取到的路由器地址  
7.将esp8266与电脑连接断开，连接到移动电源上  
8.在浏览器中打开esp8266获取到的局域网地址，通过点击上下左右按钮或键盘的光标键来控制小车  

### **活动小结**

总结课程主要内容，强调重难点
