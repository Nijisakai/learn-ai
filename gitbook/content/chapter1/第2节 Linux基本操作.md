# 第2节 Linux基本操作

---

>由于树莓派运行的`Raspbian`操作系统属于`Linux`家族，所以我们需要了解`Linux`的基本命令

---

### 内容提要

- 了解Linux终端操作
- 体验Linux终端下的基本操作
- 学会Linux终端下的文件复制，移动，粘贴
- 学会Linux终端下Nano和Vim文件编辑器的使用

### 背景知识

#### Linux 终端

终端（Terminal）也称终端设备，是计算机网络中处于网络最外围的设备，主要用于用户信息的输入以及处理结果的输出。在此处为Linux操作系统用于用户输入信息和输出信息的窗口，也是人机交流的窗口。(如下图所示：)

![alt 终端](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1578830149732&di=a5fa172218b3ffb76b443d0cd6bf46d3&imgtype=0&src=http%3A%2F%2Foranwind.s3.amazonaws.com%2F2017%2FMar%2F___-1489463518965.png)

##### 如何打开树莓派的终端(Terminal)

1.任意时刻按下键盘上的 `Ctrl + Alt + t`
2.点击快速启动栏上的终端图标

#### Shell

Shell 是一个程序，同时它又是一种程序设计语言。作为命令语言，它交互式解释和执行用户输入的命令或者自动地解释和执行预先设定好的一连串的命令；作为程序设计语言，它定义了各种变量和参数，并提供了许多在高级语言中才具有的控制结构，包括循环和分支。

在后边的学习中我们只会用到Shell命令，并且通过这些命令与树莓派(Linux)内核沟通，让树莓派执行我们想要的动作。

#### Linux目录结构

(如图所示：)
![alt tree](https://www.linuxidc.com/upload/2019_03/190301204277681.png)
在Linux系统中，目录被组织成一个:单根倒置树结构，文件系统从根目录开始，用/来表示。文件名称区分大小写（ 大小写敏感还需要看具体的文件系统格式 ）,以.开头的为隐藏文件,路径用/来进行分割（windows中使用\来分割）,文件有两个种类:元数据与数据本身.在操作linux系统时，通常会遵循以下的分层结构规则：

目录名称 | 功能
:-: | :-:
/| 根目录，位于Linux文件系统目录结构的顶层，一般根目录下只存放目录，不要存放文件
/bin|提供用户使用的基本命令， 存放二进制命令，不允许关联到独立分区
/boot|用于存放引导文件,内核文件,引导加载器
/sbin|管理类的基本命令，不能关联到独立分区，OS启动时会用到的程序
/lib|存放系统在启动时依赖的基本共享库文件以及内核模块文件
/lib64|存放64位系统上的辅助共享库文件
/etc|系统配置文件存放的目录，该目录存放系统的大部分配置文件和子目录，不建议在此目录下存放可执行文件
/home|普通用户主目录，当新建账户时，都会分配在此，建议单独分区，并分配额外空间用于存储数据
/root|系统管理员root的宿主目录
/media|便携式移动设备挂载点目录
/mnt|临时文件系统挂载点
/dev|设备（device）文件目录，存放linux系统下的设备文件，访问该目录下某个文件，相当于访问某个设备，存放连接到计算机上的设备
/opt|第三方应用程序的安装位置
/srv|服务启动之后需要访问的数据目录，存放系统上运行的服务用到的数据
/tmp|存储临时文件， 任何人都可以访问,重要数据一定不要放在此目录下
/usr|应用程序存放目录，/usr/bin 存放保证系统拥有完整功能而提供的应用程序， /usr/share 存放共享数据，/usr/lib 存放不能直接运行的，却是许多程序运行所必需的一些函数库文件，_/usr/local 存放软件升级包，第三方应用程序的安装位置，/usr/share/doc _系统说明文件存放目录
/var|放置系统中经常要发生变化的文件，如日志文件
/proc|用于输出内核与进程信息相关的虚拟文件系统，目录中的数据都在内存中
/sys|用于输出当前系统上硬件设备相关的虚拟文件系统
/selinux|存放selinux相关的信息安全策略等信息

### 常用的Shell命令

#### 磁盘操作命令

#### 注：命令在输入不完整时可食用`Tab`键补齐命令或路径上存在的文件名

1. `ls` 功能：用于显示指定工作目录下之内容（列出目前工作目录所含之文件及子目录)  
　　格式：`ls [-参数] [名称]`  
　　参数：-a 显示所有文件及目录  
　　　　　-l 显示文件或文件夹的详细信息  
　　实例：`ls -al` 列出当前目录下所有文件(包括隐藏文件)的详细信息  
　　　　　`ll` 显示文件或文件夹的详细信息(系统内置的快捷指令，相当于`ls -l`)  
&nbsp;

2. `cd` 功能：用于切换当前工作目录至指定目录  
　　格式：`cd [指定目录]`  
　　参数：无  
　　实例：`cd ~` (`~`指`/home/user/`目录)进入home目录(进入home目录也可以直接`cd + Enter`)  
　　　　　`cd /` 进入根目录  
　　　　　`cd 123` 进入当前目录下的123文件夹  
　　　　　`cd ../123` 进入上级目录下的123文件夹  
&nbsp;

3.`cp` 功能：用于复制文件或目录  
　　格式：`cp [参数] 源文件 目标目录`  
　　参数：-a 此选项通常在复制目录时使用，它保留链接、文件属性，并复制目录下的所有内容  
　　　　　-r 若给出的源文件是一个目录文件，此时将复制该目录下所有的子目录和文件  
　　实例：`cp 123.c 123.c.back` 将当前目录下的`123.c`文件复制并重命名为`123.c.back`到当前文件夹  
　　　　　`cp ../123.c ./` 复制上级目录下的`123.c`文件到当前目录下  
　　　　　`cp -r ../dir1/ ./` 复制上级目录下的`dir1`文件夹及其所有文件到当前目录下  
&nbsp;

4.`touch` 功能：用于修改文件或者目录的时间属性，若文件不存在，系统会建立一个新的文件  
　　格式：`touch [文件名]`  
　　参数：无  
　　实例：`touch 123.txt` 在当前目录下创建`123.txt`文件  
&nbsp;

5.`mkdir` 功能：用于创建文件夹  
　　格式：`mkdir 文件夹名称`  
　　参数：-p 建立多级文件夹  
　　实例：`mkdir dir1` 在当前目录下创建名称为`dir1`的文件夹  
　　　　　`mkdir -p dir1/dir2/dir3/` 在当前目录下连续创建`dir1`,`dir2`,`dir3`的子目录  
&nbsp;

6.`mv` 功能：用来为文件或目录改名、或将文件或目录移入其它位置  
　　格式：`mv [参数] 源文件 目标文件`  
　　参数：-i 若指定目录已有同名文件，则先询问是否覆盖旧文件  
　　　　　-f 在 mv 操作要覆盖某已有的目标文件时不给任何指示;  
　　实例：`mv 123.c 456.c` 将当前目录下的`123.c`文件重命名为`456.c`  
　　　　　`mv 123.c ./dir1/` 将当前目录下的123.c文件移动到当前目录的子目录`dir1`下  
&nbsp;

7.`rm` 功能：用于删除一个文件或者目录  
　　格式：`rm [参数] 名称`  
　　参数：-r 将目录以及目录中的文件全部删除  
　　　　　-f 即使文件属性为只读，也会直接删除，无需逐一确认  
　　实例：`rm 123.c` 将当前目录下的`123.c`文件删除(无确认提示，无法恢复)  
　　　　　`rm -rf ./dir1/` 删除当前目录下的`dir1`子目录及其内所有文件，且无需确认，直接删除，不可恢复  
&nbsp;

8.`cat` 功能：用于查看文件的内容(将文件内容打印到终端上用以查看)  
　　格式：`cat 目录+文件`  
　　参数：无  
　　实例：`cat 123.c` 查看`123.c`文件的内容  
&nbsp;

9.`pwd` 功能：用于显示当前工作目录的绝对路径  
　　使用方法：在终端键入：`pwd`，按`Enter`键，即显示当前工作目录的绝对路径  

#### 系统操作命令

1.Linux 操作系统命令
命令名称 | 执行动作 | 备注
:-: | :-: | :-:
`sudo apt-get update`| 更新软件源|由于改变系统环境，故加`sudo`
`sudo apt-get upgrade` |更新已安装的软件版本|由于改变系统环境，故加`sudo`
`sudo apt-get dist-upgrade`|更新系统|由于改变系统环境，故加`sudo`
`sudo apt-get install [软件名]`|安装软件|由于改变系统环境，故加`sudo`
`sudo apt-get remove [软件名]`|卸载软件|由于改变系统环境，故加`sudo`
`sudo apt-get autoremove`|自动卸载不需要的软件包|由于改变系统环境，故加`sudo`
`apt-cache search [软件名]`|搜索指定名称的软件包|由于未对系统做出改变，不需加`sudo`
`apt-cache show [软件名]`|获取包的相关信息，如说明、大小、版本|由于未对系统做出改变，不需加`sudo`
`apt-get source [软件名]`|下载软件包的源代码|由于未对系统做出改变，不需加`sudo`
`sudo apt-get clean`|清理无用软件包|与下一条命令配合使用
`sudo apt-get autoclean`|清理无用软件包|与上一条命令配合使用
`whereis [软件名]`|搜索软件并得到其详细信息|
`which [命令]`|在系统中搜索命令以确定该命令是否存在|
&nbsp;

2.`sudo` 功能：以超级用户身份运行软件或修改系统文件(类似windows10上的`以管理员身份运行`)
　　实例：`sudo apt-get install nano` :安装`nano`文本编辑软件时，由于是更改系统环境，所以需要加`sudo`
&nbsp;

3.`sudo shutdown -r now` 重启系统
　`sudo shutdown -h now` 关机
&nbsp;

4.`chmod` 功能：Linux的文件调用权限分为三级: 文件所有者、所属组、其他。`chmod`可修改文件的使用权限，即是否允许文件被其所有者，所属组，其他进行 `读(r)，写(w)，执行(x)`，三类权限分别对应八进制数：`r -> 4`,`w -> 2`,`x -> 1`
　说明：(1) User（所有者），Group(所属组)，Other(其他)分别都拥有对该文件的`rwx`权限，即：
文件所属 | User | Group | Other
:-:|:-:|:-:|:-:
权限|rwx|rwx|rwx
各权限值|421|421|421
八进制值|7|7|7
实例：`sudo chmod 666 123.sh` 去除当前目录下123.sh文件的所有所属的`可执行权限x`(八进制数为`1`)
　　　`sudo shmod 775 123.sh` 为当前目录下123.sh文件的所有所属添加`可执行权限x`
&nbsp;

5.`chown` 功能：指定文件的拥有者改为指定的用户或组，用户可以是用户名或者用户ID；组可以是组名或者组ID
　实例：`sudo chown root:root 123.py` 将123.py的用户以及用户组改为`root`(管理员用户)
　实例：`sudo chown pi:pi 123.py` 将123.py的用户以及用户组改为`pi`(普通用户)
&nbsp;

6.`netstat` 功能：用于显示与IP、TCP、UDP和ICMP协议相关的统计数据，一般用于检验本机各端口的网络连接情况。（如下图所示）
![alt netstat](https://images2018.cnblogs.com/blog/519608/201807/519608-20180706222609498-2078850432.png)
　解析：(1) `netstat`会显示当前`活动的网络连接(Active Internet connections)` 和 `活动的本地进程间通信的状态`；
　　　　(2) 通过查看这些信息我们能知道当前有哪些通信端口被占用以及当前程序工作的状态。
&nbsp;

7.`pkill` 功能：控制(关闭)同名程序的所有进程
　语法：`pkill 选项 pattern（模式）`
　参数：-G:仅匹配真实组ID在给定列表中的进程。
　　　　-t termlist:仅匹配与给定列表中终端关联的进程。
　　　　-signal:指定发往每一个匹配进程的信号
　　　　-U uidlist:仅匹配真实的用户ID在给定列表中的进程。
　实例：`pkill -9 -U UserName` 强制退出`UserName`用户
&nbsp;

#### 终端下常用应用软件的使用方法

1.`tar` 功能：将单个或多个文件(文件夹)打包或打包并压缩或解压
　参数：-c：新建打包文件，同 -v 一起使用 查看过程中打包文件名
　　　　-x：解压文件
　　　　-C：解压到对应的文件目录
　　　　-f：后边接要处理的文件
　　　　-j：通过bzip2方式压缩或解压，最后以.tar.br2 为后缀。压缩后大小小于.tar.gz
　　　　-z：通过gzip方式压缩或解压，最后以.tar.gz 为后缀
　　　　-v：显示解压或压缩的过程
　　　　-t：查看打包文件中内容，重点文件名
　　　　-u：更新压缩文件中的内容
　　　　-p：保留绝对路径，即允许备份数据中含有根目录
　　　　-P：保留数据原来权限及属性
　　　　--exclude = FILE ：压缩过程中不包含`FILE`文件
　实例：(1) `tar czvf all-txt.tar.gz ./*.txt` 将当前目录下的所有文件名以`.txt`结尾的文件，使用gzip方式压缩打包`all-txt.tar.gz`文件
　　　　(2) `tar xvf JieYaWenJian.tar.gz` 将`JieYaWenJian.tar.gz` 文件解压到当前文件夹下
&nbsp;

2.`zip` 功能：`zip`压缩文件
　参数：-d：从压缩文件内删除指定的文件
　　　　-D：压缩文件内不建立目录名称
　　　　-F：尝试修复已损坏的压缩文件
　　　　-g：将文件压缩后附加在既有的压缩文件之后，而非另行建立新的压缩文件
　　　　-i：<范本样式> 只压缩符合条件的文件
　　　　-m：将文件压缩并加入压缩文件后，删除原始文件，即把文件移到压缩文件中
　　　　-n：<字尾字符串> 不压缩具有特定字尾字符串的文件
　　　　-o：以压缩文件内拥有最新更改时间的文件为准，将压缩文件的更改时间设成和该文件相同
　　　　-r：递归处理，将指定目录下的所有文件和子目录一并处理
　　　　-q：不显示指令执行过程
　　　　-V：保存VMS操作系统的文件属性
　实例：(1) `zip -q -r html.zip /home/html` 将 /home/html/ 这个目录下所有文件和文件夹打包为当前目录下的 html.zip
　　　　(2) `zip -dv cp.zip a.c` 从压缩文件 cp.zip 中删除文件 a.c
&nbsp;

3.`unzip`解压`*.zip`文件(`*`为通配符，代指任意字符)
　用法: `unzip JieYaSuo.zip` 将`JieYaSuo.zip`文件解压到当前文件夹
&nbsp;

4.`wget` 功能：下载URL所连接的文件到本地
　用法：`wget [参数] [URL]` (`URL`即文件的下载链接，可通过浏览器点击鼠标右键并选择`复制链接地址`来获取目标的URL)
　参数：-v：显示Wget的版本信息并退出
　　　　-b：wget启动后转入后台
　　　　-q：安静模式(无信息输出)
　　　　-v：详尽的输出(此为默认值)
　　　　-nc：不要重复下载已存在的文件
　　　　-c：继续下载部分下载的文件
　　　　-O：下载文件到对应目录，并且修改文件名称
　　　　-spider：模拟下载，不会下载，只是会检查是否网站是否正常可用
　实例：(1) `wget http://mirrors.aliyun.com/ubuntu-16.04.6.iso` 将`ubuntu-16.04.6.iso`文件下载到当前目录
　　　　(2) `wget --spider www.baidu.com` 模拟下载，不会下载，只是会检查是否网站是正常可用
&nbsp;

5.`curl` 功能：curl是一个非常实用的、用来与服务器之间传输数据的工具
　用法：(1) `curl http://localhost:8080/simple-service-webapp/test/hello` 获取页面内容
![alt curl](https://img-blog.csdnimg.cn/20190526213928447.png)
　　　　(2) `curl -I http://localhost:8080/simple-service-webapp/test/hello`显示 HTTP 头，而不显示文件内容，使用 -I 选项
![alt curl](https://img-blog.csdnimg.cn/20190526213941838.png)
　　　　(3) `curl -o save.txt http://localhost:8080/simple-service-webapp/test/hello` 将返回的结果保存到文件
![alt curl](https://img-blog.csdnimg.cn/20190526214004389.png)
&nbsp;

6.`git clone` 功能：将URL指定的github代码仓库克隆到本地当前目录
　用法：`git clone [git仓库的URL]`
　实例：`git clone https://github.com/esp8266/Arduino.git` 将此链接对应的仓库克隆到本地当前目录

#### 使用文本编辑器`nano`编辑文件

1.使用nano文本编辑器打开文件`123.txt`:
　`nano 123.txt`

2.打开文件的同时显示文件行数
　`nano -c 123.txt`

3.若编辑文件时提示“权限不够”，则在命令前加`sudo` 即：
　`sudo nano 123.txt`

![alt nano](https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1880588524,1987185276&fm=11&gp=0.jpg)

4.保存使用nano编辑好的文件：键入`Ctrl + o`,然后 按下`Enter`键
　退出nano编辑器：键入`Ctrl + x`

#### 其他常见Linux命令

命令名称 | 执行动作 | 备注
:-: | :-: | :-:
`Alt + Tab`键|切换活动窗口|
`Tab`键|自动补齐|
`man [命令]`|查看命令使用手册|
`ifconfig`|查看当前网路连接状态以及IP地址|
`ping [IP地址]/[URL]`|检测与某个IP地址是否连通|
`sudo raspi-config`|打开树莓派配置界面|只针对树莓派系统
`date`|查看当前系统时间|
`date 011318172020.00`|设置时间，格式为月日时分年.秒|
`ps -ax`|显示当前运行的进程|
`kill -9 [进程号]`|关闭某个进程|
`top`|实时显示各个进程对资源的占用情况|
`passwd`|设置用户密码|
`groups`|显示当前用户所属组|
`clear`|清空终端屏幕|
`uname -m`|显示机器的处理器架构|
`which [命令]`|在系统中搜索命令以确定该命令是否存在|
&nbsp;
